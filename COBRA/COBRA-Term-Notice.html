<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NueSynergy COBRA Termination Notice</title>
  
  <!-- Performance: Preload critical resources -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
  <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
  
  <!-- CSS Frameworks & Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Animation Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  
  <!-- Signature Pad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  
  <style>
    /* Brand Colors */
    :root { 
      --primary-blue: #1E4E6B;
      --primary-blue-light: #2a5f7a;
      --accent-green: #A4C639;
      --accent-green-hover: #8fb332;
      --accent-green-dark: #4a5d23;
      --text-primary: #2d3748;
      --text-secondary: #64748b;
      --bg-primary: #f0f4f8;
      --bg-secondary: #e8f2f6;
      --border-default: #e2e8f0;
    }
    
    html, body { height: 100%; }
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary); 
    }
    
    /* Skip Link for Accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent-green);
      color: white;
      padding: 8px;
      text-decoration: none;
      z-index: 100;
    }
    .skip-link:focus {
      top: 0;
    }
    
    /* Screen Reader Only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
    
    .card { 
      background: white; 
      border-radius: 16px; 
      box-shadow: 0 8px 32px rgba(30, 78, 107, 0.1);
      transition: all 0.3s ease;
    }
    
    .step-active { display: block; animation: fadeIn 0.5s ease; } 
    .step-hidden { display: none; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    /* Journey Step Cards */
    .journey-step {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 2px solid var(--border-default);
      border-radius: 12px;
      padding: 1.25rem 0.75rem;
      transition: all 0.3s ease;
      cursor: default;
      text-align: center;
    }
    
    .journey-step.active {
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
      border-color: var(--accent-green);
      box-shadow: 0 8px 24px rgba(164, 198, 57, 0.3);
      transform: translateY(-4px);
    }
    
    .journey-step.completed {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
      border-color: var(--primary-blue);
      box-shadow: 0 4px 16px rgba(30, 78, 107, 0.2);
    }
    
    .journey-step.pending {
      opacity: 0.7;
    }
    
    .journey-icon-wrapper {
      position: relative;
      width: 50px;
      height: 50px;
      margin: 0 auto 0.75rem;
      background: linear-gradient(135deg, #f0f4f0 0%, #e5e7eb 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .journey-step.active .journey-icon-wrapper {
      background: rgba(255, 255, 255, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }
    
    .journey-step.completed .journey-icon-wrapper {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .journey-icon {
      font-size: 1.25rem;
      color: #6b7280;
      transition: all 0.3s ease;
    }
    
    .journey-step.active .journey-icon,
    .journey-step.completed .journey-icon {
      color: white;
    }
    
    .journey-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #6b7280;
      transition: all 0.3s ease;
    }
    
    .journey-step.active .journey-title,
    .journey-step.completed .journey-title {
      color: white;
    }
    
    .journey-number {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .journey-step.active .journey-number {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
    }
    
    .journey-step.completed .journey-number {
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }
    
    /* Progress Bar */
    .progress-line {
      width: 100%;
      height: 8px;
      background: var(--border-default);
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-line-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
      transition: width 0.7s ease;
      border-radius: 999px;
      position: relative;
    }
    
    .progress-line-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(200%); }
    }
    
    /* Form Elements */
    input:not([type="radio"]):not([type="checkbox"]),
    select,
    textarea {
      transition: all 0.3s ease;
    }
    
    input:focus:not([type="radio"]):not([type="checkbox"]),
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent-green) !important;
      box-shadow: 0 0 0 3px rgba(164, 198, 57, 0.1);
      transform: translateY(-1px);
    }
    
    /* Button Styles */
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(30, 78, 107, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(30, 78, 107, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-hover) 100%);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(164, 198, 57, 0.3);
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(164, 198, 57, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .sig-pad { 
      border: 2px solid rgba(164, 198, 57, 0.8);
      border-radius: 8px; 
      background: white; 
    }
    
    /* Sections with left border accent */
    section.step {
      padding: 30px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 12px;
      border-left: 4px solid var(--accent-green);
    }
    
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    @media print { 
      .no-print{display:none!important;} 
      .print-only{display:block!important;} 
      .card{box-shadow:none;border:1px solid #ddd;border-radius:0;} 
      .sig-pad{border:1px solid #ccc;} 
      body{background:#fff;color:#000;} 
    }
    
    @media (max-width: 768px) {
      .journey-step { padding: 1rem 0.5rem; }
      .journey-icon-wrapper { width: 40px; height: 40px; }
      .journey-icon { font-size: 1rem; }
      .journey-number { width: 20px; height: 20px; font-size: 0.65rem; }
      .journey-title { font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <!-- Skip Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Screen Reader Announcements -->
  <div id="status-message" class="sr-only" role="status" aria-live="polite"></div>
  <div id="error-message" class="sr-only" role="alert" aria-live="assertive"></div>
  
  <div class="min-h-full">
    <header class="animate-in relative overflow-hidden" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);">
      <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-1/2 -right-1/2 w-full h-full rounded-full" style="background: radial-gradient(circle, rgba(164, 198, 57, 0.1) 0%, transparent 70%); animation: pulse 4s ease-in-out infinite;"></div>
      </div>
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 text-white">
          <div class="flex flex-col items-start gap-2">
            <h1 class="text-3xl sm:text-4xl font-bold drop-shadow-lg">NueSynergy</h1>
            <p class="text-base sm:text-lg font-medium opacity-90">EMPLOYEE FOCUSED ASSISTANCE</p>
            <div class="flex items-center gap-3 text-sm opacity-80 mt-1">
              <span><i class="fas fa-phone-alt mr-1"></i> 1-800-413-4138</span>
              <span class="hidden sm:inline">|</span>
              <span><i class="fas fa-envelope mr-1"></i> info@nuesynergy.com</span>
            </div>
          </div>
          <div class="flex items-center gap-3 bg-white bg-opacity-10 backdrop-blur-sm rounded-lg px-4 py-3">
            <i class="fas fa-file-contract text-2xl" style="color: var(--accent-green);"></i>
            <h2 class="text-xl font-semibold" style="color: var(--accent-green);">COBRA Termination Notice</h2>
          </div>
        </div>
      </div>
    </header>

    <main id="main-content" class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 mt-5">
      <!-- Interactive Journey Tracker -->
      <nav role="navigation" aria-label="Form progress" class="mb-8">
        <div class="card p-6 sm:p-8 animate-in" id="journey-tracker">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold flex items-center" style="color: var(--primary-blue);">
                <i class="fas fa-route mr-3 text-3xl" style="color: var(--accent-green);"></i>Your Journey
              </h3>
              <p class="text-sm mt-1 ml-12" style="color: var(--text-secondary);">Track your progress through the form</p>
            </div>
            <div class="text-right mt-4 sm:mt-0">
              <span class="text-3xl font-bold" id="progressText" style="color: var(--accent-green);">Step 1</span>
              <p class="text-sm" style="color: var(--text-secondary);">of 6 steps</p>
            </div>
          </div>
          
          <!-- Animated Progress Bar -->
          <div class="progress-line mb-8">
            <div class="progress-line-fill" id="progressBar" style="width: 16.67%;"></div>
          </div>
          
          <!-- Interactive Step Cards -->
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <div class="journey-step active" id="journey-step-1" data-step="1">
              <div class="journey-icon-wrapper">
                <i class="fas fa-building journey-icon"></i>
              </div>
              <div class="journey-number">1</div>
              <h4 class="journey-title">Employer</h4>
            </div>
            
            <div class="journey-step pending" id="journey-step-2" data-step="2">
              <div class="journey-icon-wrapper">
                <i class="fas fa-user journey-icon"></i>
              </div>
              <div class="journey-number">2</div>
              <h4 class="journey-title">Employee</h4>
            </div>
            
            <div class="journey-step pending" id="journey-step-3" data-step="3">
              <div class="journey-icon-wrapper">
                <i class="fas fa-calendar-times journey-icon"></i>
              </div>
              <div class="journey-number">3</div>
              <h4 class="journey-title">Termination</h4>
            </div>
            
            <div class="journey-step pending" id="journey-step-4" data-step="4">
              <div class="journey-icon-wrapper">
                <i class="fas fa-file-medical journey-icon"></i>
              </div>
              <div class="journey-number">4</div>
              <h4 class="journey-title">Plans</h4>
            </div>
            
            <div class="journey-step pending" id="journey-step-5" data-step="5">
              <div class="journey-icon-wrapper">
                <i class="fas fa-users journey-icon"></i>
              </div>
              <div class="journey-number">5</div>
              <h4 class="journey-title">Dependents</h4>
            </div>
            
            <div class="journey-step pending" id="journey-step-6" data-step="6">
              <div class="journey-icon-wrapper">
                <i class="fas fa-check-circle journey-icon"></i>
              </div>
              <div class="journey-number">6</div>
              <h4 class="journey-title">Review</h4>
            </div>
          </div>
        </div>
      </nav>
      
      <div class="card p-6 sm:p-8">
        <div class="mb-6">

        <form id="cobraTerminationForm" class="space-y-8">
          <!-- Step 1: Employer Information -->
          <section data-step="1" class="step step-active">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Employer / Plan Sponsor Details</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Provide your organization and contact information.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Employer/Group Name <span class="text-red-500">*</span></label>
                <input name="employer_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--ns-green)]" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">FEIN</label>
                <input name="fein" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Name <span class="text-red-500">*</span></label>
                <input name="contact_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Email <span class="text-red-500">*</span></label>
                <input type="email" name="contact_email" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Phone</label>
                <input type="tel" name="contact_phone" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Notice Date <span class="text-red-500">*</span></label>
                <input type="date" name="notice_date" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
          </section>

          <!-- Step 2: Employee Information -->
          <section data-step="2" class="step step-hidden">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Employee / Qualified Beneficiary</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Provide the employee whose employment ended.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Employee Full Name <span class="text-red-500">*</span></label>
                <input name="employee_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Employee ID (optional)</label>
                <input name="employee_id" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">SSN (masked)</label>
                <input id="employee_ssn" name="employee_ssn" inputmode="numeric" autocomplete="off" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="***-**-1234" />
                <input type="hidden" id="employee_ssn_last4" name="employee_ssn_last4" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date of Birth</label>
                <input type="date" name="employee_dob" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Address</label>
                <input name="employee_address1" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="Address line 1" />
                <input name="employee_address2" class="mt-3 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="Address line 2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">City</label>
                <input name="employee_city" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">State</label>
                <input name="employee_state" maxlength="2" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2 uppercase" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Zip</label>
                <input name="employee_zip" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Phone</label>
                <input name="employee_phone" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Email</label>
                <input type="email" name="employee_email" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
          </section>

          <!-- Step 3: Termination Details -->
          <section data-step="3" class="step step-hidden">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Employment Termination Details</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Specify employment and coverage end details that trigger COBRA eligibility.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Last Day Worked <span class="text-red-500">*</span></label>
                <input type="date" name="last_day_worked" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Termination Date (employment) <span class="text-red-500">*</span></label>
                <input type="date" name="termination_date" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Coverage Loss Date</label>
                <input type="date" name="coverage_loss_date" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">COBRA Start Date (if known)</label>
                <input type="date" name="cobra_start" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Termination Type</label>
                <div class="mt-2 flex flex-wrap gap-6 text-sm">
                  <label class="inline-flex items-center gap-2"><input type="radio" name="termination_type" value="Voluntary" class="h-4 w-4 accent-[var(--ns-green)]" /> Voluntary</label>
                  <label class="inline-flex items-center gap-2"><input type="radio" name="termination_type" value="Involuntary" class="h-4 w-4 accent-[var(--ns-green)]" /> Involuntary</label>
                  <label class="inline-flex items-center gap-2"><input type="radio" name="termination_type" value="Reduction in Hours" class="h-4 w-4 accent-[var(--ns-green)]" /> Reduction in Hours</label>
                  <label class="inline-flex items-center gap-2"><input type="radio" name="termination_type" value="Other" data-tt-other data-other-input-id="termination_type_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                  <input type="text" id="termination_type_other" name="termination_type_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                </div>
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Reason / Notes</label>
                <textarea name="termination_reason" rows="3" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="Provide additional context if needed"></textarea>
              </div>
              <div class="md:col-span-2 flex items-start gap-3">
                <input id="gross_misconduct" type="checkbox" name="gross_misconduct" class="mt-1 h-4 w-4 accent-[var(--ns-green)]" />
                <label for="gross_misconduct" class="text-sm text-slate-700">Check if termination was for gross misconduct (may affect COBRA eligibility).</label>
              </div>
            </div>
          </section>

          <!-- Step 4: Plans at Time of Termination -->
          <section data-step="4" class="step step-hidden">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Plans Covered at Termination</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Indicate which plans were in effect and their details at termination.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Medical -->
              <div class="rounded-lg border-2 border-slate-200 p-4">
                <label class="flex items-center gap-3 font-semibold" style="color: var(--primary-blue);">
                  <input type="checkbox" name="plan_medical" class="h-5 w-5" style="accent-color: var(--accent-green);" /> Medical
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="medical_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="medical_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Coverage End (with employer)</label>
                    <input type="date" name="medical_end" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="Employee Only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="EE + Spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="EE + Children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Children</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="Family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="Other" data-tier-radio data-other-input-id="medical_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="medical_tier_other" name="medical_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <!-- Dental -->
              <div class="rounded-lg border-2 border-slate-200 p-4">
                <label class="flex items-center gap-3 font-semibold" style="color: var(--primary-blue);">
                  <input type="checkbox" name="plan_dental" class="h-5 w-5" style="accent-color: var(--accent-green);" /> Dental
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="dental_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="dental_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Coverage End (with employer)</label>
                    <input type="date" name="dental_end" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="Employee Only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="EE + Spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="EE + Children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Children</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="Family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="Other" data-tier-radio data-other-input-id="dental_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="dental_tier_other" name="dental_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <!-- Vision -->
              <div class="rounded-lg border-2 border-slate-200 p-4">
                <label class="flex items-center gap-3 font-semibold" style="color: var(--primary-blue);">
                  <input type="checkbox" name="plan_vision" class="h-5 w-5" style="accent-color: var(--accent-green);" /> Vision
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="vision_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="vision_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Coverage End (with employer)</label>
                    <input type="date" name="vision_end" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="Employee Only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="EE + Spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="EE + Children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Children</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="Family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="Other" data-tier-radio data-other-input-id="vision_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="vision_tier_other" name="vision_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <!-- FSA -->
              <div class="rounded-lg border-2 border-slate-200 p-4 md:col-span-2">
                <label class="flex items-center gap-3 font-semibold" style="color: var(--primary-blue);">
                  <input type="checkbox" name="plan_fsa" class="h-5 w-5" style="accent-color: var(--accent-green);" /> FSA
                </label>
                <p class="text-xs italic text-slate-600 mt-1">If applicable, provide year election and balances.</p>
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Plan Year Election</label>
                    <input name="fsa_year_election" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Amount Contributed</label>
                    <input name="fsa_amount_contributed" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Amount Disbursed</label>
                    <input name="fsa_amount_disbursed" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Coverage End (with employer)</label>
                    <input type="date" name="fsa_end" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                </div>
              </div>

              <!-- HRA (optional) -->
              <div class="rounded-lg border-2 border-slate-200 p-4 md:col-span-2">
                <label class="flex items-center gap-3 font-semibold" style="color: var(--primary-blue);">
                  <input type="checkbox" name="plan_hra" class="h-5 w-5" style="accent-color: var(--accent-green);" /> HRA
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Annual Allocation</label>
                    <input name="hra_allocation" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Amount Disbursed</label>
                    <input name="hra_disbursed" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Coverage End (with employer)</label>
                    <input type="date" name="hra_end" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 5: Dependents (optional) -->
          <section data-step="5" class="step step-hidden">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Dependents (Optional)</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Add dependents who were covered at termination.</p>
            <div class="mt-3">
              <div class="flex items-center justify-between">
                <span class="text-sm" style="color: var(--text-secondary);">Full Name, Date of Birth, Relationship</span>
                <button type="button" id="addDepBtn" class="btn-primary px-3 py-2 text-sm">Add Dependent</button>
              </div>
              <div id="dependentsContainer" class="mt-3 space-y-2"></div>
            </div>
          </section>

          <!-- Step 6: Review & Submit -->
          <section data-step="6" class="step step-hidden">
            <h3 class="text-xl font-semibold text-center" style="color: var(--primary-blue);">Review & Submit</h3>
            <p class="text-center mb-5" style="color: var(--text-secondary);">Review the entered information, sign, and submit.</p>

            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Prepared By (Employer) <span class="text-red-500">*</span></label>
                <input name="prepared_by" required class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Title</label>
                <input name="prepared_title" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date <span class="text-red-500">*</span></label>
                <input type="date" name="prepared_date" required class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
            <div class="mt-3">
              <label class="block text-sm font-medium text-slate-700 mb-2">Signature <span class="text-red-500">*</span></label>
              <canvas id="sigPad" class="sig-pad w-full h-48"></canvas>
              <div class="mt-2 flex gap-2">
                <button type="button" id="sigClear" class="btn-danger">Clear</button>
              </div>
            </div>
            <div class="flex items-start gap-3 mt-4">
              <input id="ack" type="checkbox" class="mt-1 h-4 w-4" style="accent-color: var(--accent-green);" required />
              <label for="ack" class="text-sm text-slate-700">I certify that the information submitted is accurate to the best of my knowledge.</label>
            </div>

            <div class="mt-6 p-4 rounded border border-slate-200 bg-slate-50">
              <div id="submissionSummary" class="text-sm"></div>
            </div>
            <div class="mt-4 flex flex-wrap items-center gap-3">
              <button type="button" id="downloadJsonBtn" class="px-4 py-2 rounded bg-slate-600 text-white hover:bg-slate-700 transition-all">Download Data (JSON)</button>
              <button type="button" onclick="window.print()" class="px-4 py-2 rounded border-2 text-white transition-all" style="border-color: var(--primary-blue); background: var(--primary-blue);">Print</button>
              <button type="button" id="startOverBtn" class="btn-primary">Start New</button>
            </div>
          </section>

          <!-- Navigation -->
          <div class="mt-6 pt-6 border-t border-slate-200 flex items-center justify-between no-print">
            <button type="button" id="prevBtn" class="btn-primary">Previous</button>
            <button type="button" id="nextBtn" class="btn-secondary">Next</button>
          </div>
        </form>
      </div>

      <div class="print-only text-center mt-6">
        <h1 class="text-2xl font-bold" style="color: var(--primary-blue);">NueSynergy: COBRA Termination Notice</h1>
        <p style="color: var(--text-secondary);">Generated on <span id="printDate"></span></p>
      </div>
    </main>
  </div>

  <script>
    (function(){
      'use strict';
      
      const form = document.getElementById('cobraTerminationForm');
      const steps = Array.from(document.querySelectorAll('section.step'));
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');

      let currentStep = 1; 
      const totalSteps = 6;
      
      // Accessibility: Screen reader announcements
      function announceToScreenReader(message) {
        const statusEl = document.getElementById('status-message');
        if (statusEl) {
          statusEl.textContent = message;
          setTimeout(() => { statusEl.textContent = ''; }, 3000);
        }
      }
      
      function announceError(message) {
        const errorEl = document.getElementById('error-message');
        if (errorEl) {
          errorEl.textContent = message;
          setTimeout(() => { errorEl.textContent = ''; }, 3000);
        }
      }

      // Signature
      const sigCanvas = document.getElementById('sigPad');
      let sigPad;
      function initSig(){ if(!sigCanvas) return; sigPad = new SignaturePad(sigCanvas,{backgroundColor:'white',penColor:'black',minWidth:1,maxWidth:2.5});
        document.getElementById('sigClear')?.addEventListener('click', ()=>sigPad.clear());
        const resize=()=>{ const ratio=Math.max(window.devicePixelRatio||1,1); sigCanvas.width=sigCanvas.offsetWidth*ratio; sigCanvas.height=sigCanvas.offsetHeight*ratio; sigCanvas.getContext('2d').scale(ratio,ratio);};
        window.addEventListener('resize', resize); resize(); }

      function showStep(n){
        // Hide all steps
        steps.forEach((s,i)=>{ 
          s.classList.toggle('step-active', i+1===n); 
          s.classList.toggle('step-hidden', i+1!==n); 
        });
        
        // Update buttons
        prevBtn.style.visibility = n===1 ? 'hidden':'visible';
        nextBtn.textContent = n===totalSteps-1 ? 'Submit' : 'Next';
        if(n===totalSteps) nextBtn.classList.add('hidden'); else nextBtn.classList.remove('hidden');
        
        // Update progress bar and text
        const progress = ((n-1)/(totalSteps-1))*100;
        if (progressBar) progressBar.style.width = progress + '%';
        if (progressText) progressText.textContent = `Step ${n}`;
        
        // Update journey step cards
        for (let i = 1; i <= totalSteps; i++) {
          const journeyStep = document.getElementById(`journey-step-${i}`);
          if (journeyStep) {
            journeyStep.className = 'journey-step';
            if (i < n) {
              journeyStep.classList.add('completed');
            } else if (i === n) {
              journeyStep.classList.add('active');
            } else {
              journeyStep.classList.add('pending');
            }
          }
        }
        
        // Animate step entrance if Anime.js is available
        if (typeof anime !== 'undefined') {
          const currentStepElement = steps[n-1];
          if (currentStepElement) {
            anime({
              targets: currentStepElement,
              opacity: [0, 1],
              translateX: [30, 0],
              duration: 600,
              easing: 'easeOutExpo'
            });
            
            // Animate form groups within the step
            anime({
              targets: currentStepElement.querySelectorAll('.grid > div'),
              opacity: [0, 1],
              translateY: [15, 0],
              delay: anime.stagger(40, {start: 150}),
              duration: 500,
              easing: 'easeOutQuad'
            });
          }
          
          // Pulse active journey step
          anime({
            targets: `#journey-step-${n}`,
            scale: [1, 1.05, 1],
            duration: 500,
            easing: 'easeInOutQuad'
          });
        }
        
        // Smooth scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        if(n===6 && !sigPad) setTimeout(initSig,50);
        if(n===6) document.getElementById('printDate').textContent = new Date().toLocaleString();
        
        // Announce to screen readers
        announceToScreenReader(`Step ${n} of ${totalSteps}`);
      }

      function validateStep(n){
        const stepEl = steps[n-1]; 
        if(!stepEl) return true; 
        let ok=true;
        
        Array.from(stepEl.querySelectorAll('[required]')).forEach(inp=>{ 
          const visible = inp.offsetParent!==null; 
          if(!visible) return; 
          const empty = inp.type==='checkbox'? !inp.checked : !String(inp.value||'').trim(); 
          inp.classList.toggle('ring-2', empty); 
          inp.classList.toggle('ring-red-500', empty); 
          if(empty) ok=false; 
        });
        
        if(n===6){ 
          const ack=document.getElementById('ack'); 
          if(!ack.checked) ok=false; 
          if(sigPad && sigPad.isEmpty()) ok=false; 
        }
        
        if(!ok) {
          announceError('Please complete all required fields before continuing.');
        }
        
        return ok;
      }

      // Enable/disable "Other" inputs for termination type and tiers
      document.addEventListener('change', (e)=>{
        const t = e.target; if(!(t instanceof HTMLInputElement)) return;
        if(t.matches('[data-tt-other]')){
          const otherId = t.getAttribute('data-other-input-id'); const other = otherId ? document.getElementById(otherId) : null;
          const group = t.name; const sel = document.querySelector(`input[name="${group}"]:checked`); const isOther = sel && sel.value==='Other';
          if(other){ other.disabled = !isOther; if(!isOther) other.value=''; }
        }
        if(t.matches('[data-tier-radio]')){
          const otherId = t.getAttribute('data-other-input-id'); const other = otherId ? document.getElementById(otherId) : null;
          const group = t.name; const sel = document.querySelector(`input[name="${group}"]:checked`); const isOther = sel && sel.value==='Other';
          if(other){ other.disabled = !isOther; if(!isOther) other.value=''; }
        }
      });

      // Dependents
      const depsContainer = document.getElementById('dependentsContainer');
      document.getElementById('addDepBtn')?.addEventListener('click', ()=>{
        const id = 'dep_' + Math.random().toString(36).slice(2,8);
        const row = document.createElement('div'); row.className = 'grid grid-cols-1 sm:grid-cols-12 gap-3 items-end rounded-lg border-2 border-slate-200 p-3';
        row.innerHTML = `
          <div class="sm:col-span-5">
            <label class="block text-sm text-slate-700">Full Name</label>
            <input name="dependents[${id}][name]" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
          </div>
          <div class="sm:col-span-3">
            <label class="block text-sm text-slate-700">Date of Birth</label>
            <input type="date" name="dependents[${id}][dob]" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
          </div>
          <div class="sm:col-span-3">
            <label class="block text-sm text-slate-700">Relationship</label>
            <input name="dependents[${id}][rel]" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="Spouse/Child" />
          </div>
          <div class="sm:col-span-1 text-right">
            <button type="button" class="text-sm text-red-600" data-remove>Remove</button>
          </div>`;
        row.querySelector('[data-remove]')?.addEventListener('click', ()=>row.remove());
        depsContainer.appendChild(row);
      });

      // Mask SSN to last 4
      const ssnInput = document.getElementById('employee_ssn');
      const ssnHidden = document.getElementById('employee_ssn_last4');
      function maskSSN(value){ const digits=(value||'').replace(/\D/g,'').slice(0,9); const last4=digits.slice(-4); if(ssnHidden) ssnHidden.value=last4; return last4? `***-**-${last4}` : ''; }
      if(ssnInput){ ssnInput.addEventListener('input', (e)=>{ e.target.value = maskSSN(e.target.value); }); ssnInput.addEventListener('blur', (e)=>{ e.target.value = maskSSN(e.target.value); }); }

      function gatherPayload(){
        const data = new FormData(form);
        // Dependents
        const dependents=[]; depsContainer?.querySelectorAll('input').forEach(inp=>{ const m=inp.name.match(/dependents\[(.*?)\]\[(name|dob|rel)\]/); if(!m) return; const id=m[1], key=m[2]; let d=dependents.find(x=>x.id===id); if(!d){ d={id}; dependents.push(d);} d[key]=inp.value||''; });
        return {
          formType: 'cobra_termination_notice',
          submissionTimestamp: new Date().toISOString(),
          employer: {
            employer_name: data.get('employer_name')||'', fein: data.get('fein')||'', contact_name: data.get('contact_name')||'', contact_email: data.get('contact_email')||'', contact_phone: data.get('contact_phone')||'', notice_date: data.get('notice_date')||''
          },
          employee: {
            name: data.get('employee_name')||'', employee_id: data.get('employee_id')||'', ssn_last4: data.get('employee_ssn_last4')||'', dob: data.get('employee_dob')||'', email: data.get('employee_email')||'', phone: data.get('employee_phone')||'', address1: data.get('employee_address1')||'', address2: data.get('employee_address2')||'', city: data.get('employee_city')||'', state: data.get('employee_state')||'', zip: data.get('employee_zip')||''
          },
          termination: {
            last_day_worked: data.get('last_day_worked')||'', termination_date: data.get('termination_date')||'', coverage_loss_date: data.get('coverage_loss_date')||'', cobra_start: data.get('cobra_start')||'', termination_type: data.get('termination_type')||'', termination_type_other: data.get('termination_type_other')||'', reason: data.get('termination_reason')||'', gross_misconduct: data.get('gross_misconduct')==='on'
          },
          plans: {
            medical: data.get('plan_medical')==='on' ? { carrier: data.get('medical_carrier')||'', group: data.get('medical_group')||'', end: data.get('medical_end')||'', tier: data.get('medical_tier')||'', tier_other: data.get('medical_tier_other')||'' } : null,
            dental: data.get('plan_dental')==='on' ? { carrier: data.get('dental_carrier')||'', group: data.get('dental_group')||'', end: data.get('dental_end')||'', tier: data.get('dental_tier')||'', tier_other: data.get('dental_tier_other')||'' } : null,
            vision: data.get('plan_vision')==='on' ? { carrier: data.get('vision_carrier')||'', group: data.get('vision_group')||'', end: data.get('vision_end')||'', tier: data.get('vision_tier')||'', tier_other: data.get('vision_tier_other')||'' } : null,
            fsa: data.get('plan_fsa')==='on' ? { year_election: data.get('fsa_year_election')||'', amount_contributed: data.get('fsa_amount_contributed')||'', amount_disbursed: data.get('fsa_amount_disbursed')||'', end: data.get('fsa_end')||'' } : null,
            hra: data.get('plan_hra')==='on' ? { allocation: data.get('hra_allocation')||'', disbursed: data.get('hra_disbursed')||'', end: data.get('hra_end')||'' } : null
          },
          dependents: dependents.map(({id, ...rest})=>rest),
          authorization: {
            prepared_by: data.get('prepared_by')||'', prepared_title: data.get('prepared_title')||'', prepared_date: data.get('prepared_date')||'', signature: (sigPad && !sigPad.isEmpty()) ? sigPad.toDataURL('image/png') : ''
          },
          branding: { 
            primary: '#1E4E6B', 
            secondary: '#A4C639', 
            bg_primary: '#f0f4f8',
            bg_secondary: '#e8f2f6',
            tagline: 'EMPLOYEE FOCUSED ASSISTANCE',
            phone: '1-800-413-4138',
            email: 'info@nuesynergy.com'
          },
          userAgent: navigator.userAgent
        };
      }

      async function submitToWebhook(){
        const webhookUrl='https://n8n.nuesynergy.webhook.1234';
        const payload=gatherPayload();
        const fd=new FormData();
        fd.append('payload', new Blob([JSON.stringify(payload)], {type:'application/json'}));
        try{
          const controller=new AbortController(); const tout=setTimeout(()=>controller.abort(),30000);
          const res=await fetch(webhookUrl,{method:'POST',body:fd,signal:controller.signal}); clearTimeout(tout);
          if(!res.ok) throw new Error('HTTP '+res.status);
          return true;
        }catch(err){
          try{
            const name='hidden_iframe_'+Date.now(); const ifr=document.createElement('iframe'); ifr.name=name; ifr.style.display='none'; document.body.appendChild(ifr);
            const f=document.createElement('form'); f.method='POST'; f.action=webhookUrl; f.enctype='application/x-www-form-urlencoded'; f.target=name; f.style.display='none';
            const input=document.createElement('input'); input.type='hidden'; input.name='payload'; input.value=JSON.stringify(payload); f.appendChild(input);
            document.body.appendChild(f); f.submit(); setTimeout(()=>{ try{document.body.removeChild(f);}catch{} try{document.body.removeChild(ifr);}catch{} }, 3000);
            return true;
          }catch(_){ return false; }
        }
      }

      function summarize(payload){
        const el=document.getElementById('submissionSummary');
        el.innerHTML = `
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <div><strong>Employer:</strong> ${payload.employer.employer_name||'N/A'}</div>
            <div><strong>Employee:</strong> ${payload.employee.name||'N/A'}</div>
            <div><strong>Termination:</strong> ${payload.termination.termination_date||'N/A'}</div>
            <div><strong>Coverage Loss:</strong> ${payload.termination.coverage_loss_date||'N/A'}</div>
          </div>`;
      }

      // Nav
      prevBtn.addEventListener('click',()=>{ if(currentStep>1){ currentStep--; showStep(currentStep);} });
      nextBtn.addEventListener('click', async ()=>{
        if(!validateStep(currentStep)){ alert('Please complete required fields before continuing.'); return; }
        if(currentStep===totalSteps-1){
          nextBtn.disabled=true; nextBtn.textContent='Submitting...';
          const ok = await submitToWebhook();
          const data = gatherPayload(); summarize(data);
          currentStep=totalSteps; showStep(currentStep);
          nextBtn.disabled=false; nextBtn.textContent='Next';
          return;
        }
        currentStep++; showStep(currentStep);
      });

      document.getElementById('downloadJsonBtn')?.addEventListener('click', ()=>{ const data=gatherPayload(); const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`cobra-termination-notice-${new Date().toISOString().replace(/[\:.]/g,'-')}.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
      document.getElementById('startOverBtn')?.addEventListener('click',()=>{ if(!confirm('Start a new form?')) return; form.reset(); const sig=sigPad; if(sig) sig.clear(); document.getElementById('dependentsContainer').innerHTML=''; currentStep=1; showStep(currentStep); });

      // Defaults
      const today=new Date().toISOString().split('T')[0]; 
      const preparedDate=form.querySelector('input[name="prepared_date"]'); 
      if(preparedDate) preparedDate.value=today; 
      const noticeDate=form.querySelector('input[name="notice_date"]'); 
      if(noticeDate) noticeDate.value=today;
      
      // Initialize Anime.js animations on page load
      function initAnimeAnimations() {
        if (typeof anime === 'undefined') return;
        
        // Animate header on load
        anime({
          targets: 'header.animate-in',
          opacity: [0, 1],
          translateY: [-30, 0],
          duration: 1000,
          easing: 'easeOutExpo'
        });
        
        // Animate journey tracker
        anime({
          targets: '#journey-tracker',
          opacity: [0, 1],
          translateY: [30, 0],
          duration: 800,
          delay: 200,
          easing: 'easeOutExpo'
        });
        
        // Animate journey step cards with stagger
        anime({
          targets: '.journey-step',
          opacity: [0, 1],
          translateY: [20, 0],
          scale: [0.95, 1],
          delay: anime.stagger(60, {start: 400}),
          duration: 600,
          easing: 'easeOutElastic(1, .7)'
        });
      }
      
      // Initialize on DOM ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAnimeAnimations);
      } else {
        initAnimeAnimations();
      }
      
      showStep(currentStep);
      announceToScreenReader('COBRA Termination Notice form loaded. Step 1 of 6.');
    })();
  </script>
</body>
</html>
