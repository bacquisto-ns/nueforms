<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NueSynergy COBRA Qualified Benefits Continuation Takeover</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <style>
    :root {
      --ns-blue: #1E4E6B;
      --ns-green: #A4C639;
      --ns-bg: #F0F4F0;
    }
    html, body { height: 100%; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--ns-bg); color: #1f2937; }
    .card { background: white; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
    .step-active { display: block; }
    .step-hidden { display: none; }
    .sig-pad { border: 2px solid #e5e7eb; border-radius: 8px; background: white; }
    .progress { height: 8px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%); border-radius: 999px; overflow: hidden; }
    .progress > div { height: 100%; background: linear-gradient(135deg, var(--ns-green) 0%, #8fb332 100%); transition: width .4s ease; }
    /* Shared form styling (from form-styling.md) */
    .step-card { background: #fff; border-radius: 16px; border: 1px solid rgba(30,78,107,0.1); box-shadow: 0 8px 32px rgba(30,78,107,0.1); }
    .step-card:hover { box-shadow: 0 16px 48px rgba(30,78,107,0.15); transform: translateY(-2px); transition: box-shadow .2s ease, transform .2s ease; }
    .contact-section { background: #F9FAFB; border-radius: 12px; border: 1px solid #E5E7EB; padding: 1rem; }
    .nue-primary-text { color: var(--ns-blue); }
    .progress-bar { height: 8px; background: linear-gradient(135deg, var(--ns-green) 0%, var(--ns-blue) 100%); border-radius: 999px; overflow: hidden; }
    .progress-bar > div { height: 100%; background: linear-gradient(135deg, var(--ns-green) 0%, #8fb332 100%); transition: width .4s ease; }
    .btn-primary { background: linear-gradient(135deg, var(--ns-blue), var(--ns-green)); color: #fff; padding: 0.875rem 2rem; border-radius: 0.5rem; font-weight: 600; box-shadow: 0 6px 16px rgba(30,78,107,0.2); }
    .btn-primary:hover { filter: brightness(1.05); }
    .btn-secondary { background: transparent; color: var(--ns-blue); border: 2px solid var(--ns-blue); padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; }
    .btn-secondary:hover { background: var(--ns-blue); color: #fff; }
    .step-indicator { width: 2rem; height: 2rem; display: inline-flex; align-items: center; justify-content: center; border-radius: 999px; background: #E5E7EB; color: #6B7280; font-weight: 600; }
    .step-indicator.active { background: var(--ns-green); color: #0B3D2E; box-shadow: 0 0 0 4px rgba(164,198,57,0.2); }
    .fade-in { animation: fadeIn .25s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }
    @media (prefers-reduced-motion: reduce) {
      .step-card:hover { transform: none; box-shadow: 0 8px 32px rgba(30,78,107,0.1); }
      .fade-in { animation: none; }
    }
    /* Input base styles */
    .form-input { border: 2px solid #E5E7EB; border-radius: 8px; padding: 12px 16px; }
    .form-input:focus { outline: 3px solid rgba(164,198,57,0.4); outline-offset: 2px; border-color: #A4C639; }
    /* Apply base input styles to all inputs within the form for consistency */
    #cobraForm input:not([type="radio"]):not([type="checkbox"]):not([type="file"]):not([type="hidden"]),
    #cobraForm select,
    #cobraForm textarea { border: 2px solid #E5E7EB; border-radius: 8px; padding: 12px 16px; }
    #cobraForm input:focus, #cobraForm select:focus, #cobraForm textarea:focus { outline: 3px solid rgba(164,198,57,0.4); outline-offset: 2px; border-color: #A4C639; }
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      .card { box-shadow: none; border: 1px solid #ddd; border-radius: 0; }
      .sig-pad { border: 1px solid #ccc; }
      body { background: #fff; color: #000; }
    }
  </style>
</head>
<body>
  <div class="min-h-full">
    <header class="relative overflow-hidden" style="background: linear-gradient(135deg, var(--ns-blue) 0%, #2a5f7a 100%);">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-col items-start gap-3 text-white">
            <h1 class="text-3xl sm:text-4xl font-bold drop-shadow">NueSynergy</h1>
            <p class="opacity-90">Solutions That Fit You, Not Solutions You Must Fit</p>
            <h2 class="mt-3 text-xl text-[var(--ns-green)] font-semibold">COBRA Qualified Benefits Continuation Takeover</h2>
        </div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 mt-5">
      <div class="step-card p-6 sm:p-8 fade-in">
        <div class="mb-6">
          <div class="progress-bar"><div id="progressFill" style="width:0%"></div></div>
          <div id="progressLabels" class="mt-3 text-xs sm:text-sm text-slate-500 grid grid-cols-2 sm:grid-cols-6 gap-2">
            <div class="font-medium nue-primary-text">Company</div>
            <div>Employee Info</div>
            <div>COBRA Plan Elections</div>
            <div>COBRA Population & Files</div>
            <div>Authorize & Submit</div>
            <div>Complete</div>
          </div>
        </div>

        <form id="cobraForm" class="space-y-8">
          <!-- Step 1: Company & Takeover Details -->
          <section data-step="1" class="step step-active">
            <h3 class="text-xl font-semibold nue-primary-text text-center">Company & Takeover Details</h3>
            <p class="text-slate-600 text-center mb-5">Provide employer and prior administrator information.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Employer/Group Name <span class="text-red-500">*</span></label>
                <input name="employer_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--ns-green)]" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Employer EIN <span class="text-red-500">*</span></label>
                <input name="fein" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Name <span class="text-red-500">*</span></label>
                <input name="contact_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Email <span class="text-red-500">*</span></label>
                <input type="email" name="contact_email" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Primary Contact Phone <span class="text-red-500">*</span></label>
                <input type="tel" name="contact_phone" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Takeover Effective Date <span class="text-red-500">*</span></label>
                <input type="date" name="effective_date" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div>
                <label class="block text-sm font-medium text-slate-700">Prior COBRA Administrator</label>
                <input name="prior_admin" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Prior Admin Contact Email</label>
                <input type="email" name="prior_admin_email" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
          </section>

          <!-- Step 2: Employee Information -->
          <section data-step="2" class="step step-hidden">
            <h3 class="text-xl font-semibold nue-primary-text text-center">Employee Information</h3>
            <p class="text-slate-600 text-center mb-5">Complete the below form for each employee. SSN will be masked to last four.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Employee Full Name <span class="text-red-500">*</span></label>
                <input name="employee_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">SSN (masked) <span class="text-red-500">*</span></label>
                <input id="employee_ssn" name="employee_ssn" inputmode="numeric" autocomplete="off" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="***-**-1234" />
                <input type="hidden" id="employee_ssn_last4" name="employee_ssn_last4" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date of Birth <span class="text-red-500">*</span></label>
                <input type="date" name="employee_dob" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Email <span class="text-red-500">*</span></label>
                <input type="email" name="employee_email" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Address Line 1 <span class="text-red-500">*</span></label>
                <input name="employee_address1" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Address Line 2</label>
                <input name="employee_address2" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">City <span class="text-red-500">*</span></label>
                <input name="employee_city" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">State <span class="text-red-500">*</span></label>
                <select name="employee_state" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2">
                  <option value="">Select State</option>
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="DC">District of Columbia</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Zip <span class="text-red-500">*</span></label>
                <input name="employee_zip" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Phone <span class="text-red-500">*</span></label>
                <input id="employee_phone" name="employee_phone" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="(913) 555-5555" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Gender <span class="text-red-500">*</span></label>
                <select name="employee_gender" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2">
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date of Termination <span class="text-red-500">*</span></label>
                <input type="date" name="employee_termination_date" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Reason for Termination <span class="text-red-500">*</span></label>
                <input name="employee_termination_reason" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
            
            <div class="mt-6 text-center">
              <button type="button" id="addEmployeeBtn" class="px-6 py-3 rounded-lg bg-[var(--ns-green)] text-white font-medium hover:bg-opacity-90 transition-colors">
                + Add Additional Employee
              </button>
              <div class="mt-3">
                <a href="#" class="text-sm text-[var(--ns-blue)] hover:underline">Bulk Upload Template</a>
              </div>
            </div>
          </section>

          <!-- Step 3: COBRA Plan Elections -->
          <section data-step="3" class="step step-hidden">
            <h3 class="text-xl font-semibold nue-primary-text text-center">COBRA Plan Elections</h3>
            <p class="text-slate-600 text-center mb-5">Select applicable plans and provide carrier details, deductible, and coverage tier.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="contact-section">
                <label class="flex items-center gap-3 text-[var(--ns-blue)] font-semibold">
                  <input type="checkbox" name="plan_medical" class="h-5 w-5 accent-[var(--ns-green)]" /> Medical
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="medical_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="medical_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Deductible</label>
                    <input name="medical_deductible" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="employee_only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="ee_spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="ee_children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Child(ren)</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="medical_tier" value="other" data-tier-radio data-other-input-id="medical_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="medical_tier_other" name="medical_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <div class="contact-section">
                <label class="flex items-center gap-3 text-[var(--ns-blue)] font-semibold">
                  <input type="checkbox" name="plan_dental" class="h-5 w-5 accent-[var(--ns-green)]" /> Dental
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="dental_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="dental_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Deductible</label>
                    <input name="dental_deductible" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="employee_only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="ee_spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="ee_children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Child(ren)</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="dental_tier" value="other" data-tier-radio data-other-input-id="dental_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="dental_tier_other" name="dental_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <div class="contact-section">
                <label class="flex items-center gap-3 text-[var(--ns-blue)] font-semibold">
                  <input type="checkbox" name="plan_vision" class="h-5 w-5 accent-[var(--ns-green)]" /> Vision
                </label>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Carrier</label>
                    <input name="vision_carrier" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Group Number</label>
                    <input name="vision_group" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Deductible</label>
                    <input name="vision_deductible" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                </div>
                <div class="mt-3">
                  <span class="block text-sm text-slate-700 mb-1">Coverage Tier</span>
                  <div class="flex flex-wrap gap-3 text-sm items-center">
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="employee_only" class="h-4 w-4 accent-[var(--ns-green)]" /> Employee Only</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="ee_spouse" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Spouse</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="ee_children" class="h-4 w-4 accent-[var(--ns-green)]" /> EE + Child(ren)</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="family" class="h-4 w-4 accent-[var(--ns-green)]" /> Family</label>
                    <label class="inline-flex items-center gap-2"><input type="radio" name="vision_tier" value="other" data-tier-radio data-other-input-id="vision_tier_other" class="h-4 w-4 accent-[var(--ns-green)]" /> Other</label>
                    <input type="text" id="vision_tier_other" name="vision_tier_other" placeholder="Specify other" class="border-2 border-slate-200 rounded px-3 py-2 disabled:bg-slate-100" disabled />
                  </div>
                </div>
              </div>

              <div class="contact-section">
                <label class="flex items-center gap-3 text-[var(--ns-blue)] font-semibold">
                  <input type="checkbox" name="plan_fsa" class="h-5 w-5 accent-[var(--ns-green)]" /> FSA
                </label>
                <p class="mt-2 text-xs italic text-slate-600">If NueSynergy is NOT the FSA administrator, please provide the following information:</p>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-3">
                  <div>
                    <label class="block text-sm text-slate-700">Initial Amount Elected</label>
                    <input name="fsa_initial_elected" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700">Amount Contributed</label>
                    <input name="fsa_amount_contributed" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                  <div>
                    <label class="block text-sm text-slate-700 leading-tight">Amount<br />Disbursed</label>
                    <input name="fsa_amount_disbursed" class="mt-1 w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="$" />
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 4: COBRA Population & Files -->
          <section data-step="4" class="step step-hidden">
            <h3 class="text-xl font-semibold nue-primary-text text-center">COBRA Population & Required Files</h3>
            <p class="text-slate-600 text-center mb-5">Provide counts and upload supporting documentation.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Active COBRA Participants <span class="text-red-500">*</span></label>
                <input type="number" min="0" step="1" name="active_participants" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Last Paid-Through Date <span class="text-red-500">*</span></label>
                <input type="date" name="last_paid_through" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>

            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Participant Roster (CSV/XLSX/PDF)</label>
                <input id="file_roster" type="file" accept=".csv,.xlsx,.xls,.pdf" class="mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-[var(--ns-blue)] file:text-white hover:file:opacity-90" />
                <p class="text-xs text-slate-500 mt-1">Include current COBRA participants, dependents, coverage tier, and premium amounts.</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Rate Sheets / Carrier Bills (PDF)</label>
                <input id="file_rates" type="file" accept=".pdf" class="mt-1 block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-[var(--ns-blue)] file:text-white hover:file:opacity-90" />
              </div>

            </div>
          </section>

          <!-- Step 5: Authorization & Submit -->
          <section data-step="5" class="step step-hidden">
            <h3 class="text-xl font-semibold nue-primary-text text-center">Authorization & Submission</h3>
            <p class="text-slate-600 text-center mb-5">Please review, sign, and submit.</p>

            <div class="space-y-4">
              <div class="rounded-lg border-2 border-slate-200 p-4 bg-slate-50">
                <p class="text-sm text-slate-700">By signing below, I certify that I am authorized to provide COBRA takeover information on behalf of the Employer/Group listed and that the information submitted is accurate to the best of my knowledge.</p>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label class="block text-sm font-medium text-slate-700">Authorized Signer Full Name <span class="text-red-500">*</span></label>
                  <input name="auth_full_name" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700">Title</label>
                  <input name="auth_title" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-700">Date <span class="text-red-500">*</span></label>
                  <input type="date" name="auth_date" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-2">Signature <span class="text-red-500">*</span></label>
                <canvas id="sigPad" class="sig-pad w-full h-48"></canvas>
                <div class="mt-2 flex gap-2">
                  <button type="button" id="sigClear" class="px-3 py-2 rounded bg-slate-600 text-white text-sm">Clear</button>
                </div>
              </div>
              <div class="flex items-start gap-3 mt-3">
                <input id="ack" type="checkbox" class="mt-1 h-4 w-4 accent-[var(--ns-green)]" required />
                <label for="ack" class="text-sm text-slate-700">I acknowledge NueSynergy will process COBRA takeover according to provided documentation and will contact the primary contact if clarification is needed.</label>
              </div>
            </div>
          </section>

          <!-- Confirmation -->
          <section data-step="6" class="step step-hidden">
            <div class="text-center">
              <div class="mx-auto w-20 h-20 rounded-full flex items-center justify-center text-white text-3xl font-bold" style="background: linear-gradient(135deg, var(--ns-green) 0%, #8fb332 100%);">✓</div>
              <h3 class="mt-4 text-2xl font-semibold text-[var(--ns-blue)]">Submission Received</h3>
              <p class="mt-2 text-slate-600">Thank you. Your COBRA takeover details were submitted successfully.</p>
              <div id="submissionSummary" class="mt-6 text-left mx-auto max-w-4xl p-6 bg-slate-50 rounded border border-slate-200"></div>
              <div class="mt-6 flex flex-wrap items-center justify-center gap-3">
                <button type="button" onclick="window.print()" class="btn-secondary">Print</button>
                <button type="button" id="startOverBtn" class="btn-primary">Start New</button>
              </div>
            </div>
          </section>

          <!-- Nav -->
          <div class="mt-6 pt-6 border-t border-slate-200 flex items-center justify-between no-print">
            <button type="button" id="prevBtn" class="btn-secondary">Previous</button>
            <div class="flex items-center gap-2">
              <button type="button" id="skipBtn" class="hidden btn-secondary">Skip</button>
              <button type="button" id="nextBtn" class="btn-primary">Next</button>
            </div>
          </div>
        </form>
      </div>

      <div class="print-only text-center mt-6">
        <h1 class="text-2xl font-bold nue-primary-text">NueSynergy: COBRA Qualified Benefits Continuation Takeover</h1>
        <p class="text-slate-600">Generated on <span id="printDate"></span></p>
      </div>
    </main>
  </div>

  <script>
    (function() {
      const form = document.getElementById('cobraForm');
      const steps = Array.from(document.querySelectorAll('section.step'));
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const skipBtn = document.getElementById('skipBtn');
      const progressFill = document.getElementById('progressFill');
      const progressLabels = Array.from(document.querySelectorAll('#progressLabels > div'));

      let currentStep = 1;
      const totalSteps = 6;

      // Signature Pad
      const sigCanvas = document.getElementById('sigPad');
      let sigPad;
      function initSigPad() {
        if (!sigCanvas) return;
        sigPad = new SignaturePad(sigCanvas, {
          backgroundColor: 'rgba(255,255,255,1)',
          penColor: 'rgb(0,0,0)',
          minWidth: 1.0,
          maxWidth: 2.5,
        });
        const clearBtn = document.getElementById('sigClear');
        clearBtn?.addEventListener('click', () => sigPad.clear());
        function resize() {
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          sigCanvas.width = sigCanvas.offsetWidth * ratio;
          sigCanvas.height = sigCanvas.offsetHeight * ratio;
          sigCanvas.getContext('2d').scale(ratio, ratio);
        }
        window.addEventListener('resize', resize);
        resize();
      }

      function showStep(n) {
        steps.forEach((s,i) => {
          s.classList.toggle('step-active', i+1 === n);
          s.classList.toggle('step-hidden', i+1 !== n);
        });
        prevBtn.style.visibility = n === 1 ? 'hidden' : 'visible';
        if (n < totalSteps) nextBtn.textContent = n === totalSteps - 1 ? 'Submit' : 'Next';
        if (n === totalSteps) nextBtn.classList.add('hidden'); else nextBtn.classList.remove('hidden');
        progressFill.style.width = ((n-1)/(totalSteps-1))*100 + '%';
        progressLabels.forEach((el, idx) => el.classList.toggle('font-semibold', idx < n));
        if (n === 5 && !sigPad) setTimeout(initSigPad, 50);
        if (n === 6) document.getElementById('printDate').textContent = new Date().toLocaleString();
      }

      // Enable/disable "Other" text inputs tied to tier radios
      document.addEventListener('change', (e) => {
        const target = e.target;
        if (!(target instanceof HTMLInputElement)) return;
        if (target.matches('[data-tier-radio]')) {
          const groupName = target.name;
          const otherInputId = target.getAttribute('data-other-input-id');
          const otherInput = otherInputId ? document.getElementById(otherInputId) : null;
          const selected = document.querySelector(`input[name="${groupName}"]:checked`);
          const isOther = selected && selected.value === 'other';
          if (otherInput) {
            otherInput.disabled = !isOther;
            if (!isOther) otherInput.value = '';
          }
        }
      });

      function validateStep(n) {
        const stepEl = steps[n-1];
        if (!stepEl) return true;
        const required = Array.from(stepEl.querySelectorAll('[required]'));
        let ok = true;
        required.forEach(inp => {
          const visible = inp.offsetParent !== null;
          if (!visible) return;
          const empty = inp.type === 'checkbox' ? !inp.checked : !String(inp.value||'').trim();
          inp.classList.toggle('ring-2', empty);
          inp.classList.toggle('ring-red-500', empty);
          if (empty) ok = false;
        });
        if (n === 4) {
          // File uploads are now optional, no validation needed
        }
        if (n === 5) {
          const ack = document.getElementById('ack');
          if (!ack.checked) ok = false;
          if (sigPad && sigPad.isEmpty()) ok = false;
        }
        return ok;
      }

      async function toJSONPayload() {
        const data = new FormData(form);
        const payload = {
          formType: 'cobra_takeover',
          submissionTimestamp: new Date().toISOString(),
          company: {
            employer_name: data.get('employer_name')||'',
            fein: data.get('fein')||'',
            contact_name: data.get('contact_name')||'',
            contact_email: data.get('contact_email')||'',
            contact_phone: data.get('contact_phone')||'',
            effective_date: data.get('effective_date')||''
          },
          priorAdministrator: {
            name: data.get('prior_admin')||'',
            email: data.get('prior_admin_email')||''
          },
          employee: {
            name: data.get('employee_name')||'',
            ssn_last4: data.get('employee_ssn_last4')||'',
            dob: data.get('employee_dob')||'',
            email: data.get('employee_email')||'',
            address1: data.get('employee_address1')||'',
            address2: data.get('employee_address2')||'',
            city: data.get('employee_city')||'',
            state: data.get('employee_state')||'',
            zip: data.get('employee_zip')||'',
            phone: data.get('employee_phone')||''
          },
          plans: {
            medical: data.get('plan_medical') === 'on' ? {
              carrier: data.get('medical_carrier')||'',
              group: data.get('medical_group')||'',
              deductible: data.get('medical_deductible')||'',
              tier: data.get('medical_tier')||'',
              tier_other: data.get('medical_tier_other')||''
            } : null,
            dental: data.get('plan_dental') === 'on' ? {
              carrier: data.get('dental_carrier')||'',
              group: data.get('dental_group')||'',
              deductible: data.get('dental_deductible')||'',
              tier: data.get('dental_tier')||'',
              tier_other: data.get('dental_tier_other')||''
            } : null,
            vision: data.get('plan_vision') === 'on' ? {
              carrier: data.get('vision_carrier')||'',
              group: data.get('vision_group')||'',
              deductible: data.get('vision_deductible')||'',
              tier: data.get('vision_tier')||'',
              tier_other: data.get('vision_tier_other')||''
            } : null,
            fsa: data.get('plan_fsa') === 'on' ? {
              initial_amount_elected: data.get('fsa_initial_elected')||'',
              amount_contributed: data.get('fsa_amount_contributed')||'',
              amount_disbursed: data.get('fsa_amount_disbursed')||''
            } : null
          },
          population: {
            active_participants: Number(data.get('active_participants')||0),
            pending_elections: Number(data.get('pending_elections')||0),
            last_paid_through: data.get('last_paid_through')||''
          },
          authorization: {
            auth_full_name: data.get('auth_full_name')||'',
            auth_title: data.get('auth_title')||'',
            auth_date: data.get('auth_date')||'',
            signature: sigPad && !sigPad.isEmpty() ? sigPad.toDataURL('image/png') : ''
          },
          documents: {
            roster_attached: !!document.getElementById('file_roster')?.files?.length,
            rates_attached: !!document.getElementById('file_rates')?.files?.length,
            takeover_letter_attached: false,
            additional_count: 0
          },
          branding: { primary: '#1E4E6B', secondary: '#A4C639', bg: '#F0F4F0' },
          userAgent: navigator.userAgent
        };
        return payload;
      }

      function collectMultipartForm(payload) {
        const fd = new FormData();
        fd.append('payload', new Blob([JSON.stringify(payload)], { type: 'application/json' }));
        const roster = document.getElementById('file_roster')?.files?.[0];
        const rates = document.getElementById('file_rates')?.files?.[0];
        if (roster) fd.append('roster', roster);
        if (rates) fd.append('rates', rates);
        return fd;
      }

      async function submitToWebhook() {
        const webhookUrl = 'https://services.leadconnectorhq.com/hooks/dmDqFsUr8qcR0BbIu70O/webhook-trigger/ee199673-bc95-4606-94c3-1be4db0630d7';
        const payload = await toJSONPayload();
        const multipart = collectMultipartForm(payload);

        try {
          const controller = new AbortController();
          const timeout = setTimeout(() => controller.abort(), 30000);
          const res = await fetch(webhookUrl, { method: 'PUT', body: multipart, signal: controller.signal });
          clearTimeout(timeout);
          if (!res.ok) throw new Error('HTTP '+res.status);
          return true;
        } catch (err) {
          try {
            // Fallback: post JSON payload to a hidden iframe to avoid navigating away
            const iframeName = 'hidden_iframe_' + Date.now();
            const iframe = document.createElement('iframe');
            iframe.name = iframeName;
            iframe.style.display = 'none';
            document.body.appendChild(iframe);

            const form = document.createElement('form');
            form.method = 'PUT';
            form.action = webhookUrl;
            form.enctype = 'application/x-www-form-urlencoded';
            form.target = iframeName;
            form.style.display = 'none';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'payload';
            input.value = JSON.stringify(payload);
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();

            // Clean up after a short delay
            setTimeout(() => {
              try { document.body.removeChild(form); } catch {}
              try { document.body.removeChild(iframe); } catch {}
            }, 3000);

            return true;
          } catch (fallbackErr) {
            console.error('Fallback submission failed:', fallbackErr);
            return false;
          }
        }
      }

      function summarize(payload) {
        const el = document.getElementById('submissionSummary');
        el.innerHTML = `
          <div class="space-y-6">
            <div>
              <h4 class="font-semibold text-[var(--ns-blue)] text-lg mb-3">Company & Takeover Details</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <div><strong>Employer/Group Name:</strong> ${payload.company.employer_name || 'N/A'}</div>
                <div><strong>Employer EIN:</strong> ${payload.company.fein || 'N/A'}</div>
                <div><strong>Primary Contact:</strong> ${payload.company.contact_name || 'N/A'}</div>
                <div><strong>Contact Email:</strong> ${payload.company.contact_email || 'N/A'}</div>
                <div><strong>Contact Phone:</strong> ${payload.company.contact_phone || 'N/A'}</div>
                <div><strong>Takeover Effective Date:</strong> ${payload.company.effective_date || 'N/A'}</div>
                <div><strong>Prior COBRA Administrator:</strong> ${payload.priorAdministrator.name || 'N/A'}</div>
                <div><strong>Prior Admin Email:</strong> ${payload.priorAdministrator.email || 'N/A'}</div>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold text-[var(--ns-blue)] text-lg mb-3">Employee Information</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <div><strong>Employee Name:</strong> ${payload.employee.name || 'N/A'}</div>
                <div><strong>SSN (Last 4):</strong> ${payload.employee.ssn_last4 || 'N/A'}</div>
                <div><strong>Date of Birth:</strong> ${payload.employee.dob || 'N/A'}</div>
                <div><strong>Email:</strong> ${payload.employee.email || 'N/A'}</div>
                <div><strong>Address:</strong> ${payload.employee.address1 || 'N/A'}</div>
                <div><strong>City:</strong> ${payload.employee.city || 'N/A'}</div>
                <div><strong>State:</strong> ${payload.employee.state || 'N/A'}</div>
                <div><strong>Zip:</strong> ${payload.employee.zip || 'N/A'}</div>
                <div><strong>Phone:</strong> ${payload.employee.phone || 'N/A'}</div>
                <div><strong>Gender:</strong> ${payload.employee.gender || 'N/A'}</div>
                <div><strong>Termination Date:</strong> ${payload.employee.termination_date || 'N/A'}</div>
                <div><strong>Termination Reason:</strong> ${payload.employee.termination_reason || 'N/A'}</div>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold text-[var(--ns-blue)] text-lg mb-3">COBRA Plan Elections</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                ${payload.plans.medical ? `<div><strong>Medical:</strong> ${payload.plans.medical.carrier} - ${payload.plans.medical.tier}</div>` : ''}
                ${payload.plans.dental ? `<div><strong>Dental:</strong> ${payload.plans.dental.carrier} - ${payload.plans.dental.tier}</div>` : ''}
                ${payload.plans.vision ? `<div><strong>Vision:</strong> ${payload.plans.vision.carrier} - ${payload.plans.vision.tier}</div>` : ''}
                ${payload.plans.fsa ? `<div><strong>FSA:</strong> Initial: $${payload.plans.fsa.initial_amount_elected || 'N/A'}</div>` : ''}
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold text-[var(--ns-blue)] text-lg mb-3">COBRA Population</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <div><strong>Active COBRA Participants:</strong> ${payload.population.active_participants}</div>
                <div><strong>Last Paid-Through Date:</strong> ${payload.population.last_paid_through || 'N/A'}</div>
              </div>
            </div>
            
            <div>
              <h4 class="font-semibold text-[var(--ns-blue)] text-lg mb-3">Authorization</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <div><strong>Authorized Signer:</strong> ${payload.authorization.auth_full_name || 'N/A'}</div>
                <div><strong>Title:</strong> ${payload.authorization.auth_title || 'N/A'}</div>
                <div><strong>Date:</strong> ${payload.authorization.auth_date || 'N/A'}</div>
                <div><strong>Signature:</strong> ${payload.authorization.signature ? '✓ Provided' : 'Not provided'}</div>
              </div>
            </div>
          </div>
        `;
      }

      prevBtn.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep -= 1;
          showStep(currentStep);
        }
      });

      nextBtn.addEventListener('click', async () => {
        if (!validateStep(currentStep)) {
          alert('Please complete required fields before continuing.');
          return;
        }
        if (currentStep === totalSteps - 1) {
          nextBtn.disabled = true;
          nextBtn.textContent = 'Submitting...';
          const data = await toJSONPayload();
          const ok = await submitToWebhook();
          summarize(data);
          currentStep = totalSteps;
          showStep(currentStep);
          nextBtn.disabled = false;
          nextBtn.textContent = 'Next';
          return;
        }
        currentStep += 1;
        showStep(currentStep);
      });



      document.getElementById('startOverBtn')?.addEventListener('click', () => {
        if (!confirm('Start a new submission? This will clear the current data.')) return;
        form.reset();
        if (sigPad) sigPad.clear();
        currentStep = 1;
        showStep(currentStep);
      });

      // Defaults
      const today = new Date().toISOString().split('T')[0];
      const authDate = form.querySelector('input[name="auth_date"]');
      if (authDate) authDate.value = today;
      
      // Set the print date immediately
      const printDateEl = document.getElementById('printDate');
      if (printDateEl) printDateEl.textContent = new Date().toLocaleString();
      // Mask SSN: keep only last 4 visible in placeholder/input and store last4 in hidden field
      const ssnInput = document.getElementById('employee_ssn');
      const ssnHidden = document.getElementById('employee_ssn_last4');
      function maskSSN(value) {
        const digits = (value || '').replace(/\D/g, '').slice(0, 9);
        const last4 = digits.slice(-4);
        if (ssnHidden) ssnHidden.value = last4;
        // show only last 4 with ***-**- prefix
        return last4 ? `***-**-${last4}` : '';
      }
      if (ssnInput) {
        ssnInput.addEventListener('input', (e) => {
          const v = e.target.value;
          const masked = maskSSN(v);
          e.target.value = masked;
        });
        ssnInput.addEventListener('blur', (e) => {
          const v = e.target.value;
          e.target.value = maskSSN(v);
        });
      }
      
      // Format phone number as (XXX) XXX-XXXX
      const phoneInput = document.getElementById('employee_phone');
      function formatPhone(value) {
        const digits = (value || '').replace(/\D/g, '').slice(0, 10);
        if (digits.length === 0) return '';
        if (digits.length <= 3) return `(${digits}`;
        if (digits.length <= 6) return `(${digits.slice(0, 3)}) ${digits.slice(3)}`;
        return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
      }
      if (phoneInput) {
        phoneInput.addEventListener('input', (e) => {
          const v = e.target.value;
          const formatted = formatPhone(v);
          e.target.value = formatted;
        });
        phoneInput.addEventListener('blur', (e) => {
          const v = e.target.value;
          e.target.value = formatPhone(v);
        });
      }
      
      // Add Additional Employee functionality
      const addEmployeeBtn = document.getElementById('addEmployeeBtn');
      let employeeCount = 1;
      
      if (addEmployeeBtn) {
        addEmployeeBtn.addEventListener('click', () => {
          employeeCount++;
          const employeeSection = document.querySelector('[data-step="2"]');
          const addButtonDiv = employeeSection.querySelector('.mt-6.text-center');
          
          const newEmployeeDiv = document.createElement('div');
          newEmployeeDiv.className = 'mt-8 p-6 border-2 border-slate-200 rounded-lg bg-slate-50';
          newEmployeeDiv.innerHTML = `
            <h4 class="text-lg font-semibold text-[var(--ns-blue)] mb-4">Employee ${employeeCount}</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-700">Employee Full Name <span class="text-red-500">*</span></label>
                <input name="employee_name_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">SSN (masked) <span class="text-red-500">*</span></label>
                <input name="employee_ssn_${employeeCount}" inputmode="numeric" autocomplete="off" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="***-**-1234" />
                <input type="hidden" name="employee_ssn_last4_${employeeCount}" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date of Birth <span class="text-red-500">*</span></label>
                <input type="date" name="employee_dob_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Email <span class="text-red-500">*</span></label>
                <input type="email" name="employee_email_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Address Line 1 <span class="text-red-500">*</span></label>
                <input name="employee_address1_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Address Line 2</label>
                <input name="employee_address2_${employeeCount}" class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">City <span class="text-red-500">*</span></label>
                <input name="employee_city_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">State <span class="text-red-500">*</span></label>
                <select name="employee_state_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2">
                  <option value="">Select State</option>
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="DC">District of Columbia</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Zip <span class="text-red-500">*</span></label>
                <input name="employee_zip_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Phone <span class="text-red-500">*</span></label>
                <input name="employee_phone_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" placeholder="(913) 555-5555" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Gender <span class="text-red-500">*</span></label>
                <select name="employee_gender_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2">
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Date of Termination <span class="text-red-500">*</span></label>
                <input type="date" name="employee_termination_date_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Reason for Termination <span class="text-red-500">*</span></label>
                <input name="employee_termination_reason_${employeeCount}" required class="mt-1 block w-full rounded-md border-2 border-slate-200 px-3 py-2" />
              </div>
            </div>
            <div class="mt-4 text-right">
              <button type="button" class="remove-employee-btn px-3 py-1 rounded bg-red-600 text-white text-sm hover:bg-red-700" onclick="this.closest('.mt-8').remove()">Remove Employee</button>
            </div>
          `;
          
          // Insert the new employee section before the add button
          addButtonDiv.parentNode.insertBefore(newEmployeeDiv, addButtonDiv);
          
          // Add event listeners for the new fields
          const newSSNInput = newEmployeeDiv.querySelector(`input[name="employee_ssn_${employeeCount}"]`);
          const newSSNHidden = newEmployeeDiv.querySelector(`input[name="employee_ssn_last4_${employeeCount}"]`);
          const newPhoneInput = newEmployeeDiv.querySelector(`input[name="employee_phone_${employeeCount}"]`);
          
          // Add SSN masking for new employee
          if (newSSNInput && newSSNHidden) {
            newSSNInput.addEventListener('input', (e) => {
              const v = e.target.value;
              const masked = maskSSN(v);
              e.target.value = masked;
            });
            newSSNInput.addEventListener('blur', (e) => {
              const v = e.target.value;
              e.target.value = maskSSN(v);
            });
          }
          
          // Add phone formatting for new employee
          if (newPhoneInput) {
            newPhoneInput.addEventListener('input', (e) => {
              const v = e.target.value;
              const formatted = formatPhone(v);
              e.target.value = formatted;
            });
            newPhoneInput.addEventListener('blur', (e) => {
              const v = e.target.value;
              e.target.value = formatPhone(v);
            });
          }
        });
      }
      showStep(currentStep);
    })();
  </script>
</body>
</html>
